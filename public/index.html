<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
	<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1" />
    <title>Web Teach</title>
	<script src="js/jquery-1.9.1.js"></script>
	<script src="js/jquery-ui-1.10.2.custom.js"></script>
    <script src="/socket.io/socket.io.js"></script>
	
	<!-- Module complementaire pour le traitement de la video et du channel de discutions -->
	<script type="text/javascript" src="js/pannel.js"></script>
	<script type="text/javascript" src="js/video.js"></script>
	
	<!-- On relie la feuille de style -->
	<link rel='stylesheet' href="css/style.css" type='text/css' media='screen' /></script>
	<link href="css/smoothness/jquery-ui-1.10.2.custom.css" rel="stylesheet">
    <script type="text/javascript">
	
        <!-- Variable global -->
		var mon_identifiant = "";
        var password = "";
		var socket;
		var slideControlContainer;
		var TempoMaster = false;
        var master = false;
		
        $(document).ready(function () {

        socket = io.connect();

        <!-- Se lance apres l authentification, et permet de s enregistrer aupres du serveur afin d avertir un nouvelle utilisateur -->
        $("#identification").click(function () {
			if ($("#identifiant").val() != "") {
				$('#identification').unbind('click');
				$(".img-loading").css("visibility", "visible");
				mon_identifiant = $("#identifiant").val();
                password = $("#password").val();
				
				if ($("#master").is(':checked') == true) {
					TempoMaster = true;
                    $("#menu-control").removeClass('isHidden');
                }

				socket.emit('ouvertureSession', JSON.stringify({
					identifant: mon_identifiant,
                    password: password,
                    master: TempoMaster
				}));
			  
				$("#menu-pseudo").html("Bonjour " + mon_identifiant);
                
                if (TempoMaster === true) {
                    socket.emit('requestMaster', mon_identifiant);
                }
			}
        });
		
		<!-- On Verifie si on charge bien une presentation html -->
		$("#img-select").click(function () {
			$("#hiddenfile").click();
			
			$("#hiddenfile").change(function() {
				if ($("#hiddenfile").val().split('.').reverse()[0] == "html") {
					$("#selected-Slide").val($("#hiddenfile").val());
                }
			});
		});	

		<!-- Reception des messages du serveur et traitement des messages en fonction des donnees recues -->  	
        socket.on('message', function (data) {
			var obj = jQuery.parseJSON(data);
            
			if (obj.le_next) {
				slideControlContainer.selectIndex(obj.le_slide);
			} else if (obj.le_prev) {			
				slideControlContainer.selectIndex(obj.le_slide);
			} else if (obj.le_first) {			
				$($('#notre_frame').contents()).find("#first").click();
			} else if (obj.le_last) {			
				$($('#notre_frame').contents()).find("#last").click();
			} else if (obj.url) {			
				$('#notre_frame').attr("src", obj.url);
			} else if (obj.le_msg) { // reception et traitement des messages de discussion
				$("#message ul").append("<li>(" + obj.le_pseudo + "): " + obj.le_msg + "</li>");
				$("#message").scrollTop(100000) ;
				
				<!-- Notification du pannel (rouge clignotant) -->
				if ($("#cadre-menu").css("margin-Left") == "0px") {
					if($('#bouton-menu').html()) {
						var nbNewMessage = parseInt($('#bouton-menu b').html()) + 1;
                    } else {
						var nbNewMessage = 1;
                    }
					$('#bouton-menu').html("(<b>" + nbNewMessage + "</b>)");
				}
		  	  
			} else {
				var ma_liste = "";
                
				for (var i = 0; i < obj.tab_client.length; i++) {
					ma_liste += "<li>" + obj.tab_client[i] + "</li>";
				}
				
				$('#cadre-user ul').html(ma_liste); // actualisation de la liste des pseudos
				$('#clients').text(obj.clients);    // affichage nombre de client connecte
				
				if (obj.connexion) {
					$("#message ul").append("<li><font color='green'>(" + obj.connexion + ") s'est connect&#233;</font> </li>");
					var timeLoad = 200;
                    
					if (obj.ppt) { // Change la presentation sur les postes esclave
						$("#notre_frame").attr("src","ppt/" + obj.ppt);
						timeLoad = 3000;
					}
					
					setTimeout(function() {
						initVideo(); //charge les controles pour la gestion de la video
						chargementSlide(); 
						
						if (obj.le_slide) {
							slideControlContainer.selectIndex(obj.le_slide); // lors de la connection on charge le slide en cours
                        }
                            
						$("#div_connection").hide();
						$("#overlay").hide();
					}, timeLoad);
				}
                
				if (obj.arrayMasters) {                    
                    if (obj.arrayMasters.indexOf(mon_identifiant) == -1) {
                        master = false;
                        $("#menu-control").addClass("isHidden");
                        $("#cadre-video").id = "cadre-video-disable";
                    } else {
                        master = true;
                        $("#menu-control").removeClass("isHidden");
                        $("#cadre-video-disable").attr("id", "cadre-video");
                    }
                }
					
				if (obj.pseudo) {
					$("#message ul").append("<li><font color='green'>(" + obj.pseudo + ") s'est connect&#233;</font> </li>");	
                }	
                    
				if (obj.deconnexion) {
					$("#message ul").append("<li><font color='red'>(" + obj.deconnexion + ") s'est d&#233connect&#233;</font> </li>");
                }
			}
        });
                    
        <!-- Les esclaves recois l id du slide ou de l element clique du poste master et on simule le click -->    
		socket.on('recupObjetHtml', function (idtempo) {
			if(idtempo) {
				$($('#notre_frame').contents()).find("#" + idtempo).click();
			}
		});  
            
		<!-- Permet de recuperer les evenements de la gestion des slides et de les envoyer au poste esclave -->
        $("#next1").click(function () {
			if (master == true) {
				$($('#notre_frame').contents()).find("#next").click();
				socket.send(JSON.stringify({
				    suivant: "next",
				    slide: slideControlContainer.currentIndex // on envoi l'ID du slide
				}));
			}        
        });

        $("#prev1").click(function() {
			if (master == true) {
				$($('#notre_frame').contents()).find("#prev").click();	
				socket.send(JSON.stringify({
					precedant: "prev",
					slide: slideControlContainer.currentIndex // on envoi l'ID du slide
				}));
			 }
        });

        $("#first1").click(function() {
			if (master == true) {
				$($('#notre_frame').contents()).find("#first").click();
				socket.send(JSON.stringify({
					premier: "first"
				}));
			}
        });

        $("#last1").click(function () {
			if (master == true) {
				  $($('#notre_frame').contents()).find("#last").click();
				  socket.send(JSON.stringify({
					dernier: "last"
				  }));
			}
        });
     });
	  
    <!-- Permet de charger les slides et de creer des evenements sur la presentation -->
    function chargementSlide() {
        var containers = $($('#notre_frame').contents())[0].getTimeContainersByTagName("*");
        slideControlContainer = containers[containers.length - 1];

        <!-- Permet de recuperer l action fait sur le master et de le simuler sur les postes client connectes -->
        $($('#notre_frame').contents()).find(".slide").click(function(e){
            e.stopPropagation();		
             if (master == true) {	
                idtempo = this.id;
                socket.emit('envoiRefObjetHtml', idtempo);  
            }
        }); 

        $($('#notre_frame').contents()).find("li").not("[class='highlight']").click(function(e) {
            if($(this).parent().attr("class")!="incremental") {
                e.stopPropagation();	
                 if (master == true) {		
                    idtempo = this.id;
                    socket.emit('envoiRefObjetHtml', idtempo);  
                }
            }
        }); 
    };  

	<!-- Permet de ne pas autocratiser les caracteres speciaux pour le pseudo -->
	function special_caract(evt) {
		var keyCode = evt.which ? evt.which : evt.keyCode;
		if (keyCode == 9) {
            return true;
        }  
		var interdit = 'ààâäãçéèêëìîïòôöõµùûüñ &\?!:\.;,\t#~"^¨@%\$£?²¤§%\*()[]{}-_=+<>|\\/`\'';
		if (interdit.indexOf(String.fromCharCode(keyCode)) >= 0) { 
		  return false;
        }
	}	    

    </script>
  </head>

	<!-- Page de connection -->  
	<body topmargin="0" leftmargin="0" style="width:100%;">
    <div id="overlay" style="background:white; opacity:1; width:100%; height:115%; display:block; z-index:5"></div>
	<div id="div_connection" style="z-index:5;" >
        <div style="text-align: center;">
            <a><strong style="font-size:16px;">Bienvenue sur WebTeach !</strong></a><br /><br /><br />
            <input type="text" maxlength="12" name="identifiant" id="identifiant" title="13 caracteres max" onKeypress="return special_caract(event);" value="" placeholder="Pseudo" /><br />
            <input type="password" maxlength="12" name="password" id="password" title="13 caracteres max" onKeypress="return special_caract(event);" value="" placeholder="Mot de passe (optionnel)"/><br />	
            <label style="display:block; text-indent:-15px;  width:78%; color:#555555;">
                <input type="checkbox" id="master" style="width:11px; height:11px; padding:0; margin:0; vertical-align: bottom; position: relative; top:1px; *overflow: hidden;" />Annimateur
            </label><br />	
            <div class="img-connect" id="identification"></div><br />
    
        <!--		<a>Choisir une pr&#233;sentation (option) :</a><br/><br/>
                <input type="file" id="hiddenfile" style="display:none"  accept='text/html' />
                <input type="text" id="selected-Slide" readonly="readonly"/>
                <div class="img-select" id="img-select"></div> -->
        </div>
	</div>
	<!-- Fin de la connection --> 

	<!-- Menu de changement de Slide -->
    <div style="position:fixed; width:100%; height:33px; repeat:x; background-image:url('images/titre2.png')">
        <div style="position:absolute;top:0px;left:0px;">
            <img src="images/titre1.png" />
        </div>
        <div id="menu-control" class="isHidden" style="position:relative; width:105px; margin:auto; padding-top:6px;">
            <img src="images/fond-player.png" />
            <ul id="liste_player">
                <li>
                    <img id="first1" src="images/first.png" />
                </li>
                <li>
                    <img id="prev1" src="images/prev.png" />
                </li>
                <li>
                    <img id="next1" src="images/next.png" />
                </li>
                <li>
                    <img id="last1" src="images/last.png" />
                </li>
			</ul>
        </div>
		<div id="menu-pseudo" style="position:absolute; top:10px; right:20%; font:16px Arial; color:#555;"></div>
        <div id="boutton-user" style="position:absolute; top:0px; right:0px;">
			<span style="position:absolute; top:6px; left:19px; color:#787777; font-size:19px;" id="clients"></span>
			<img src="images/titre3.png" />
		</div>	  
    </div>
	<div style="z-index:3; position:fixed; top:33px; left:0px; width:100%; height:3px; repeat:x; background-image:url('images/degrade-inf.png')"></div>
	<!-- Fin Menu de changement de Slide -->
	

	<!-- Fenetre des utilisateurs connectes -->
	<div id="cadre-user">
        <ul></ul>
	</div>
	
	<!-- Pannel de discussion -->
	<div id="cadre-menu">
		<div id="bordure-menu">
			<div id="message">
				<ul></ul>
			</div>
			<input id="input_text" type="text" value="Tapez votre message!" onclick="this.value='';"  />
			<div id="img-send"></div>
		</div>
		<div id="bouton-menu"></div>
	</div>
	

	<IFRAME id="notre_frame"  src="ppt/video.html"></IFRAME> 


	<!-- Control video -->
	<div id="cadre-video-disable" class="isHidden">
		<button id="lectureVideo">play</button>		
		<div id="cadre-video-droit">
			<div style="width:250px; " id="barre"></div>
			<img src="images/fermer.png" style="cursor:pointer; float:right; padding-top:2px;" id="fermeture_controle_video" />
		</div>
	</div>
  </body>
</html>