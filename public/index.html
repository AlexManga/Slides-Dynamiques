<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  
  <head>
    <title>Demo</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript">
      $(document).ready(function ()
      {

        var mon_identifiant = "";
        var master = false;

        var height_content = $("#content").height();
        $("#overlay").css(
        {
          "position": "absolute",
          "top": "0",
          "left": "0px",
          "display": "block"
        });
        var positionLeft = $(document).scrollLeft() + (($(window).width() * 50) / 100) - ((50 * parseInt($('#div_connection').width())) / 100);
        $('#div_connection').css(
        {
          "left": positionLeft + 'px'
        });

        $("#div_connection").show();

        $("#connection").click(function ()
        {
          var height_content = $("#content").height();
          $("#overlay").css(
          {
            "position": "absolute",
            "top": "0",
            "left": "0px",
            "display": "block"
          });
          var positionLeft = $(document).scrollLeft() + (($(window).width() * 50) / 100) - ((50 * parseInt($('#div_connection').width())) / 100);
          $('#div_connection').css(
          {
            "left": positionLeft + 'px'
          });

          $("#div_connection").show();

        });
/////////////////////////////////////////////////////////////////////
        //connection avec un compte client/master (temporaire, non secure, utilisation du websocket pour requetter le serveur ?)
        $("#identification").click(function ()
        {

          $("#div_connection").hide();
          $("#overlay").hide();

          mon_identifiant = $("#identifiant").val();

          if (mon_identifiant == "master")
          {
            master = true;
          }
          $("#bonjour").html("Bonjour");
          $("#connection").html(mon_identifiant);

        });
////////////////////////////////////////////////////////////////////////////
        //Au click sur la croix dans la div de l'overlay
        $('#fermeture_overlay1').click(function ()
        {
          $("#div_connection").hide();
          $("#overlay").hide();
        });

        var socket = io.connect();
        socket.on('message', function (data)
        {
          //var obj = jQuery.JSON.parse(data);
		  var obj = jQuery.parseJSON(data);
          if (obj.le_next)
          {
            $('#pos_y').text(obj.le_next);
            $($('#notre_frame').contents()).find("#next").click();
          }
          else if (obj.le_prev)
          {
            $('#pos_x').text(obj.le_prev);
            $($('#notre_frame').contents()).find("#prev").click();
          }
          else if (obj.le_first)
          {
            $('#pos_x').text(obj.le_prev);
            $($('#notre_frame').contents()).find("#first").click();
          }
          else if (obj.le_last)
          {
            $('#pos_x').text(obj.le_prev);
            $($('#notre_frame').contents()).find("#last").click();
          }
          else if (obj.url)
          {
            $('#notre_frame').attr("src", obj.url);
          }
          else
          {
            $('#num_client').text(obj.num_client);
            var ma_liste = "";
            for (var i = 0; i < obj.tab_client.length; i++) {
                ma_liste = ma_liste + obj.tab_client[i] + " - ";
            }
            $('#exemple').text(ma_liste);
            $('#timestamp').text(obj.timestamp);
            $('#clients').text(obj.clients);
          }
        });
        
///////////////////////////////////////////////////////////        
       
			$('#notre_frame').load(function(){
			$($(this).contents()).find("li").click(function(e){
						//$(this).html("coucou");
						e.stopPropagation();

					 if (master==true)
					{	
				
						idtempo = this.id;
					   // alert("id="+$(this).find("span").html());

					socket.emit('envoiRefObjetHtml', idtempo);  
					}
					
				}); 
			});  
        
    socket.on('recupObjetHtml', function (idtempo) {
	
	/*
    
  if( $($('#notre_frame').contents()).find("#"+idtempo).attr("class")!="active")
  {
    
        $($('#notre_frame').contents()).find("#"+idtempo).attr("class","active");
			
        $($('#notre_frame').contents()).find("#"+idtempo).attr("smil","active");
    }else{
 
  
    
		$($('#notre_frame').contents()).find("#"+idtempo).attr("class","li_class");
			
		$($('#notre_frame').contents()).find("#"+idtempo).attr("smil","idle");
 
 
    }
	*/
	 $($('#notre_frame').contents()).find("#"+idtempo).click();
    
  }); 
  
  
	//$($('#notre_frame').contents()).find('li').css.({'left': '50%'});		
						
        
///////////////////////////////////////////////////////////////

        $("#next1").click(function ()
        {
			if (master==true)
		{
                    
          $($('#notre_frame').contents()).find("#next").click();
          
          
          socket.send(JSON.stringify(
          {
            suivant: "next"
          }));
          }
          
        });

        $("#prev1").click(function ()
        {
        
        if (master==true)
		{
        
        $($('#notre_frame').contents()).find("#prev").click();
        
        
          socket.send(JSON.stringify(
          {
            precedant: "prev"
          }));
		  }

        });

        $("#first1").click(function ()
        {
		
		if (master==true)
		{
            $($('#notre_frame').contents()).find("#first").click();
            
          socket.send(JSON.stringify(
          {
            premier: "first"
          }));
		  
		  }
        });

        $("#last1").click(function ()
        {
		
		if (master==true)
		{
          $($('#notre_frame').contents()).find("#last").click();
          socket.send(JSON.stringify(
          {
            dernier: "last"
          }));
		  
		  }
        });
        $('#btn_ok').click(function ()
        {
          $('#notre_frame').attr('src', $('#input_url').val());
          netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
          var url = $('#input_url').val();
          socket.send(JSON.stringify(
          {
            url: url
          }));
        });
		
		$('#btn_send').click(function ()
		{
		var ContenuChannel = $('#channel').html();
		var texte = document.getElementById("input_text").value;
		
		if (identifiant != "")
		{
			//var texte = $('input_text').val();
			$('#channel').html(''+ContenuChannel+'<br><font color=black>&lt' +identifiant+ '&gt ' +texte+ '<br></font>');
			$("#channel").scrollTop(30000000000);
		}
		else
		{
		$('#channel').html(''+ContenuChannel+'<br><font color=black>&ltAnonymous&gt ' +texte+ '<br></font>');
		$("#channel").scrollTop(30000000000);
		
		}
		});
		
		
		$('#notre_frame').click(function ()
		{
			$("#notre_frame").scrollRight(30000000000);
		});
		
        $("#open").click(function ()
        {
          if ($("#open").attr("statut") == 'off')
          {
		   
            $('#menu-deroule').show(1000);
            $("#open").attr('src', 'images/close.png');
            $("#open").attr('statut', 'on');

          }
          else
          {
            $('#menu-deroule').hide(1000);
            $("#open").attr('src', 'images/open.png');
            $("#open").attr('statut', 'off');
          }
        });

          $("#open_channel").click(function ()
        {
        
          if ($("#open_channel").attr("statut") == 'off')
          {
            $('#menu-deroule2').show(1100);
            $("#open_channel").attr('src', 'images/close2.png');
            $("#open_channel").attr('statut', 'on');
			
            $("#toto").animate({
              left : "148"
              },1065);			  
    }
          else
          {
            $('#menu-deroule2').hide(1000);
            $("#open_channel").attr('src', 'images/open2.png');
            $("#open_channel").attr('statut', 'off');
            $("#toto").animate({
              left : "8"
              },1000);
          }
        });

      });
	  
	  function getId()
		{	
			identifiant = document.getElementById("identifiant").value;
			
			if (identifiant != "")
			{
			$("#channel").html('<font color=green><I>&lt' +identifiant+ '&gt vient de se connecter !</I><br></font>');
			}
			
			else 
			{
			$("#channel").html('<font color=green><I>&ltAnonymous&gt vient de se connecter !</I><br></font>');
			}	
		}
	  function getId2()
		{	
			identifiant = document.getElementById("identifiant").value;
			$("#channel").html('<font color=green><I>&ltAnonymous&gt vient de se connecter !</I><br></font>');
		}	
    </script>
  </head>
  
  <body topmargin="0" leftmargin="0" style="width:100%;">
 <div id="overlay" style="background:black; opacity:0.7; width:100%;
    height:115%; display:block; z-index:1"></div>
<div id="div_connection" style="z-index:2; display:none; position:absolute; top:250px; background:white; padding:15px; font-family:arial; font-size:12px;box-shadow: 1px 1px 4px black;">
<img src="images/fermer.png" style="float:right; cursor:pointer;" id="fermeture_overlay1" onclick="getId2();"/>
<a><strong>Bienvenue sur WebTeach !</strong></a><br/><br/>
<a>Veuillez entrer votre identifiant :</a><br/><br />
<INPUT type=text name="identifiant" id="identifiant">
<INPUT type="submit" style="background:url(images/btn-connect.png) no-repeat; width:118px; height:22px" value="" id="identification" onclick="getId();">
</div>

    <style>
      #liste_player {
        margin :0px;
        padding:0px;
        list-style-type:none;
        position:absolute;
        top:8px;
      }
      #liste_player li {
        float:left;
        margin-left:12px;
        cursor:pointer;
      }
    </style>

    <div style="width:100%;height:33px;repeat:x;background-image:url('images/titre2.png')">
      <div style="position:absolute;top:0px;left:0px;margin-left : 30px">
        <img src="images/titre1.png" />
      </div>
      <div style="position:relative;width:105px;margin:auto;padding-top:6px;">
        <img src="images/fond-player.png" />
        <ul id="liste_player">
          <li>
            <img id="first1" src="images/first.png" />
          </li>
          <li>
            <img id="prev1" src="images/prev.png" />
          </li>
          <li>
            <img id="next1" src="images/next.png" />
          </li>
          <li>
            <img id="last1" src="images/last.png" />
          </li>
        </ul>
      </div>
      <div style="position:absolute;top:0px;right:0px;">
        <span style="position:absolute;top:6px;left:19px;color:#787777;font-size:19px;"
        id="clients"></span>
        <img src="images/titre3.png" />
      </div>
    </div>
    <div id="menu-deroule" style="height:100px;display:none;">
      <div style="margin-left:150px; margin-top:14px;">
        <img src="images/url-presentation.png" />
        <br>
        <input type="text" value="" id="input_url" style="width:500px;height:22px;">
        <img id="btn_ok" style="margin-top:20px;margin-left:2px;" src="images/btn-ok.png"
        />
      </div>
    </div>


	

    <div style="position:relative;width:100%;">
      <div style="z-index:9;position:absolute;top:0px;left:0px;width:100%;height:3px;repeat:x;background-image:url('images/degrade-inf.png')"></div>
      <div id="url" style="width:100%;position:absolute;margin:auto;cursor:pointer;z-index:10;">
        <center>
          <img id="open" statut="off" src="images/open.png"/>
        </center>
		
      </div>
		 </div>
		<table width=100% height=100%  border="0" cellspacing="0" cellpadding="0"> 
			<tr>
				<td>	
					<div id="menu-deroule2" style="width:36px;display:none;">
						<div style="left:6px; top:54px; position:absolute; z-index:3000; height : 90%">  
							<div id="channel" style="border: 1px solid #000; padding:4px; resize: none; height:89%; width:120px; overflow: auto; white-space : pre-line;">
							</div> 
							<br>
							<input type="text" value="Tapez votre message!" id="input_text" style="font-style:italic;font-size:12;width:130px;height:22px;" onclick="this.value='';"/>
							 <br>
							 <img id="btn_send" src="images/btn-send.png" style="width:130px;height:22px;">
						</div>
					</div>
						<div id="toto" style="position:absolute;margin-left:auto;top:320px; left:8px;cursor:pointer;z-index:20;">
							<img id="open_channel" statut="off" src="images/open2.png"/>
						</div>
				</td>
				<td>
					<IFRAME id="notre_frame"  src="ppt/CoursWebVTT2012/webvtt.html" width=99,99% height=100% style="overflow-x: hidden; margin-left : 8px"></IFRAME> 
				</td>
			</tr>
		</table>
	</body>
</html>